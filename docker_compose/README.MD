# Файл docker-compose має починатися з тега версії.
# Ми використовуємо "3" так як це найсвіжіша версія на момент написання цього коду.

version: "3"

# Слід враховувати, що docker-composes працює із сервісами.
# 1 сервіс = 1 контейнер.
Сервісом може бути клієнт, сервер, сервер баз даних.
# Розділ, в якому будуть описані послуги, починається з 'services'.

services:

   # Як уже було сказано, ми збираємося створити клієнтську та серверну програми.
   # Це означає, що нам потрібні два сервіси.
   Перший сервіс (контейнер): сервер.
   Назвати його можна так, як потрібно розробнику.
   # Зрозуміла назва сервісу допомагає визначити його роль.
   # Тут ми для іменування відповідного сервісу використовуємо ключове слово 'server'.

   server:
 
     # Ключове слово "build" дозволяє задати
     шлях до файлу Dockerfile, який потрібно використовувати для створення образу,
     # який дозволить запустити сервіс.
     # Тут 'server/' відповідає шляху до папки сервера,
     яка містить відповідний Dockerfile.

     build: server/

     # Команда, яку потрібно запустити після створення образу.
     # Наступна команда означає запуск "python./server.py".

     command: python ./server.py

     # Згадайте про те, що портом 'server/server.py' є порт 5000.
     # Якщо ми хочемо звернутися до сервера з нашого комп'ютера (перебуваючи за межами контейнера),
     ми повинні організувати перенаправлення цього порту на порт комп'ютера.
     # Зробити це допоможе ключове слово 'ports'.
     # При використанні застосовується наступна конструкція: [порт комп'ютера]:[порт контейнера]
     # У нашому випадку потрібно використовувати порт комп'ютера 5000 та організувати його зв'язок з портом
     # 5000 контейнера (оскільки саме на цей порт сервер
     # очікує надходження запитів).

     ports:
       - 5000:5000

   Другий сервіс (контейнер): клієнт.
   # Цей сервіс названий 'client'.

   client:
     # Тут 'client/ відповідає шляху до папки, яка містить
     # Dockerfile файл для клієнтської частини системи.

     build: client/

     # Команда, яку потрібно запустити після створення образу.
     # Наступна команда означає запуск "python./client.py".
 
     command: python ./client.py

     # Ключове слово 'network_mode' використовується для опису типу мережі.
     # Тут ми вказуємо те, що контейнер може звертатися до 'localhost' комп'ютера.

     network_mode: host

     # Ключове слово 'depends_on' дозволяє вказувати, чи сервіс повинен,
     # Перш ніж запуститися, чекати, коли будуть готові до роботи інші послуги.
     # Нам потрібно, щоб сервіс 'client' дочекався б готовності до роботи сервісу 'server'.
 
     depends_on:
       - server